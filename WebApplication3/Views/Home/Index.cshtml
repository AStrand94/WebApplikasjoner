@{
    ViewBag.Title = "Home Page";
}
@model List<WebApplication3.Models.Airport>
<script src="~/Scripts/bootstrap-datepicker.min.js"></script>
<script src="~/Scripts/bootstrap-datepicker.js"></script>

<h2>
    HEI
</h2>
<form action="/home/registerflight" onsubmit="return checkForm(this);" method="get">
    <div class="form-group" style="float:left; width:40%;">
        <label for="fromAirportId">Travel from:</label>
        <select class="form-control" id="fromAirportId" name="fromAirportId">
            <option selected disabled hidden>Select airport..</option>
            @foreach (var airport in Model)
            {
                <option value="@airport.Id">@airport.Name</option>
            }
        </select>
    </div>
    <div class="form-group" style="margin-left:40px;">
        <label for="toAirportId">Travel to:</label>
        <select class="form-control" id="toAirportId" name="toAirportId">
            <option selected disabled hidden>Select airport..</option>
            @foreach (var airport in Model)
            {
                <option value="@airport.Id">@airport.Name</option>
            }
        </select>
    </div>
<label id="errorLabel" style="color:darkred;font-size:large;" hidden></label><br/>
    <label for="fromDate">Traveling date:</label>
    <div class="input-group date" data-provide="datepicker" style="width:20%;" id="fromDate">
        <input id="date" name="date" type="text" class="form-control">
        <div class="input-group-addon">
            <span class="glyphicon glyphicon-th"></span>
        </div>
    </div>
    <br />
    <input type="submit" class="btn btn-success" value="Submit Button"/>
</form>
<a href="/Home/Registration">Registrer</a>

<script>
    //CREATE JQUERY CHECK FOR IF DATE IS VALID

    $(document).ready(function () {
        $('.datepicker').datepicker({
            format: 'mm/dd/yyyy',
            startDate: '+1d'
        });

        $('#fromDate').datepicker().on('changeDate', function (ev) {
            $('#fromDate').datepicker('hide');
            var date = $('#date').val();
            console.log(date);
            if (!isValidDate(date)) {
                $('#errorLabel').text("Wrong date");
                $('#errorLabel').show();
            } else {
                $('#errorLabel').hide();
            }
        });

        $('#toDate').datepicker().on('changeDate', function (ev) {
            $('#toDate').datepicker('hide');
        });
    });

    function isValidDate(dateString) {
        if (!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dateString))
            return false;

        var parts = dateString.split("/");
        var day = parseInt(parts[1], 10);
        var month = parseInt(parts[0], 10);
        var year = parseInt(parts[2], 10);

        if (year < 1000 || year > 3000 || month == 0 || month > 12)
            return false;

        var monthLength = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

        if (year % 400 == 0 || (year % 100 != 0 && year % 4 == 0))
            monthLength[1] = 29;

        return day > 0 && day <= monthLength[month - 1];
    };

    function checkForm(formVals) {
        var from = formVals.fromAirportId.value;
        var to = formVals.toAirportId.value;
        var date = formVals.date.value;

        if (from === to || !from || !to) {
            document.getElementById('errorLabel').innerHTML = 'You cannot travel to the same airport!';
            return false;
        } else if (!isValidDate(date)) {
            document.getElementById('errorLabel').innerHTML = 'Wrong format for the date';
            return false;
        }
        return true;
    }
</script>